---
title: Binary and Tool Outputs
description: Learn how to manage build tools and executables in your Grog build process for better reproducibility.
---

import { Aside } from "@astrojs/starlight/components";

## Managing Build Tools

An important aspect of creating a reproducible build process is properly managing the toolchain of compilers, linters, and other executables needed for your builds. Grog provides two mechanisms to help with this:

1. **Binary Outputs**: Targets that produce executable files that can be used as tools to build other targets

   - **Advantage**: Enables caching and better reproducibility between hosts
   - **Disadvantage**: Not all tools can be packaged as single portable binaries

2. **Bin-path Outputs**: A special output type that verifies a tool is already installed on the host system
   - **Advantage**: Easy to set up using standard installation scripts
   - **Disadvantage**: Less reproducible since Grog can't verify the exact version or build of the tool

## Binary Outputs

A binary output is an executable file produced by a build target that can be used by other targets in your build graph. This approach is ideal for tools that can be compiled or packaged as a single executable.

### How to Define a Binary Output

Each target can specify a single `bin_output` field that points to a file output. When the build completes, Grog will:

1. Mark this file as executable
2. Make it available to dependent targets via the `$(bin :target_name)` syntax

### Example: Creating and Using a Binary Tool

```yaml
targets:
  # Target that builds a tool
  - name: protoc_compiler
    command: |
      curl -L https://github.com/protocolbuffers/protobuf/releases/download/v3.19.4/protoc-3.19.4-linux-x86_64.zip -o protoc.zip
      unzip protoc.zip -d protoc
      chmod +x protoc/bin/protoc
    outputs:
      - protoc/include/google/protobuf/
    bin_output: protoc/bin/protoc

  # Target that uses the tool
  - name: generate_protos
    dependencies:
      - :protoc_compiler
    inputs:
      - proto/*.proto
    command: |
      # Use the binary tool with $(bin :target_name)
      $(bin :protoc_compiler) --cpp_out=generated proto/*.proto
    outputs:
      - dir::generated
```

### Running Binary Tools Directly

You can also run binary tools directly using the `grog run` command:

```shell
# Run the tool with arguments
grog run //package:protoc_compiler -- --help

# This is equivalent to building the tool and then running it
grog build //package:protoc_compiler
./path/to/protoc/bin/protoc --help
```

<Aside>
  Binary outputs are cached just like any other output, which means Grog will
  avoid rebuilding the tool if nothing has changed, making your builds faster.
</Aside>

## Bin-path Outputs

For tools that can't easily be packaged as a single binary or that require complex installation procedures, Grog provides bin-path outputs. These verify that a tool is available in the system PATH.

### How to Define a Bin-path Output

```yaml
targets:
  - name: ensure_nvm
    command: |
      # Download and install nvm:
      curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.40.3/install.sh | bash
    bin_output: bin-path::nvm

  - name: ensure_node_22
    command: |
      nvm install 22
    bin_output: bin-path::node
    bin_output_check:
      # If specified, grog will run this command everytime the tool
      # is used to check that it has the correct version
      command: "node --version"
      expected: "v20.11.1"
    dependencies:
      - :ensure_nvm

  - name: build_js
    dependencies:
      - :ensure_node_22
    command: |
      # Node is now guaranteed to be available
      node build.js
    inputs:
      - src/**/*.js
      - package.json
    outputs:
      - dist/bundle.js
```

In this example, the `ensure_node` target verifies that `node` is available in the PATH.
If it's not, the command installs it.
The `bin_output: bin-path::node` tells Grog to check for the `node` command in the `PATH` after the build completes.

### Advantages of Bin-path Outputs

- Works with tools that have complex installation procedures
- Allows using system-provided tools without rebuilding them
- Simplifies integration with existing toolchains

<Aside type="caution">
  While bin-path outputs are convenient, they reduce build reproducibility since
  different environments might have different versions of the tools. Consider
  using binary outputs for critical build tools when possible.
</Aside>

## Best Practices

1. **Prefer binary outputs** for critical build tools to ensure reproducibility
2. **Use bin-path outputs** for tools with complex dependencies or installation requirements
3. **Version your tools** explicitly in your build definitions
4. **Consider using Docker** for tools with complex system dependencies (see [Docker Outputs](/guides/docker-outputs))
5. **Cache tool installations** to speed up builds, especially in CI environments

By properly managing your build tools with Grog, you can create more reproducible and reliable build processes across different environments.
