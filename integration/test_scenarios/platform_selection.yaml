name: platform selection
repo: platform_selection
cases:
  - name: skip_if_platform_no_match
    args:
      - build
      - //pkg/...

  - name: select_by_os
    args:
      - build
      - //:os_guard
    env_vars:
      - "GROG_OS=made-up-os"

  - name: select_by_arch
    args:
      - build
      - //:arch_guard
    env_vars:
      - "GROG_ARCH=made-up-arch"

  - name: select_by_both_arch_and_os
    args:
      - build
    env_vars:
      - "GROG_OS=made-up-os"
      - "GROG_ARCH=made-up-arch"

  - name: dep_platform_mismatch_should_fail
    args:
      - build
      - :bar
    expect_fail: true
